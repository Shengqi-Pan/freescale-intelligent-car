# 硬件设计与调试

## PCB Version 3.0

电磁检测插在MCU母板上

不带5V和12V稳压的电机驱动

底盘换成PCB，把无线充电方案、5V、12V稳压和MCU母板放上去

-----------------------------;

无线充电方案

## TODO LIST

### 母板V2.0和电磁检测V2.0板子硬件调试

- 更换左侧竖电感

- 调节四个电位器，使左右横竖电感的AD采样值对称

- 直立控制测试

- 无线串口接收测试

---------------------

**7.14~7.16：基本正常**

### 车底盘，PCB上把5V、12V稳压、母板放在一起

- ~~5V和12V输出的单点接地 SGND、PGND~~

- ~~按键S2~S5、RST封装修改~~

- 供电开关按键修改，要能流通大电流

- 可能需要修改电机控制、编码器、陀螺仪、无线串口的接口位置

- 需要增大一些接口之间的间距，以避免排线插接冲突

- ~~TPS630701封装修改，便于焊接和虚焊检查~~

- 检查供电接入开关、母板5V开关、驱动板12V开关是否加进去了

- ~~TPS61088封装修改~~

- PCB尺寸定义与检查

- 给ICM留出2.5*1.5的空间

-------------------------------;

**7.15：车底盘，母板v4.0已制板**
**7.19：TPS61088升压12V无输出，计划7.20重焊，再测试一下thermal pad焊盘和PGND的连通性**

- 理一下国赛电路合集里面的61088升压

- 修改大电流回路的一些器件封装，包括电感换成功率电感。

- 板子上加入日期

**7.19：烧了两块TPS61088（有一段时间能够正常输出过），目前还没有查出问题出在哪里，拿TPS630701的输出接了EN脚，又把630701烧了......**

**7.20：准备更换12V稳压芯片方案**

- 除复位键按钮，剩余按钮改为拨码开关

- 稳压的5v可以考虑直接供给单片机，尽量不出现一个端子接两线的情况

- 主板的电感为六路电感，主板ad读取接口可以加上P06, P12, P16，上面三个引脚没有其它用处的话作为六路电感多出的两个电感

- 若单片机需要控制充电，任意空闲的GPIO留出作为控制引脚

- 也可多留两个废物引脚当备胎

- 可以考虑加蜂鸣器，P37，参考逐飞

### 电磁检测PCB

- 多加一个OPA2350，增加一路电感AD采样用于判坡

- 在母板上留出的尺寸空间也要作修改

- ~~**！！！要修改滤波的方式，更改输出滤波电路，RC串联加稳压和反向限幅**~~

- ~~**直接修改OPA2350为OPA4377，增加一路电感，暂时空出一路**~~

- ~~**加一路OPA2350，仿照OPAMOD模块**~~

----------------------------;

**7.13：电磁检测v2.0已改完制板，贴片电阻改为0603封装，电容为C0805**

**7.17：焊完了电磁检测的板子，毛刺问题、电磁测量值的非线性问题。**

### 电机驱动板

----------------------------;

**7.16：焊接和调试，发现一个小问题：由于自举电容的机制约束，HIP4082驱动全桥的上管在原理上应该不能到100%占空比，这一点需要在之后的软件里面测试和注意。**

**7.20：在考虑是否把电机和驱动分两块芯片供电，34063升压可能电流负载能力不足。**

### 无线充电方案

- 恒功率充电 or 简单的全桥整流？

---------------------------;

**7.17：目前的想法是，接收端640KHZ LC谐振，然后四个肖特基二极管全桥整流，再稳压到12V，再接入SuperCap组，在线路上做电压电流的采样，送入单片机做乘积得到实时功率，然后PID控制MOS通断（BUCK）来控制平均充电电流（或者电压），做到稳定充电功率的效果**

**References：**

> [飞思卡尔恒功率无线充电（上）](https://cloud.tencent.com/developer/article/1651860) \
> [飞思卡尔恒功率无线充电（中）](https://cloud.tencent.com/developer/article/1651861) \
> [飞思卡尔恒功率无线充电（下）](https://cloud.tencent.com/developer/article/1651862)

**7.19：芯片选型**

- 备选器件

  - 前期12V转5V稳压：TPS5410，REG104，TPS561201

  - 全波整流转12V：TPS54360（需要额外注意设定其开关频率）

  - 电容：NPO高频电容

  - 电感：功率电感

**7.20凌晨：电路原理图基本完成，下一步更新封装和画PCB**

### 元器件

- OPA2350

- 100K电位器

- 稳压管

- 47K电阻

- TPS630701

- 61088外围电路元件RLC

- 工字电感

--------------------------;

**7.16：买了新一批器件**

**7.19：准备更换外围无源元件选型**

- 贴片陶瓷电容

- NPO高频电容

- 闭环控制、电压检测、反馈回路的电阻均要换成高精度低温漂电阻

**7.20凌晨：准备买元件**


