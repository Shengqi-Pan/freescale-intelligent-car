C51 COMPILER V9.60.0.0   ICM20602                                                          06/19/2020 21:33:20 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE ICM20602
OBJECT MODULE PLACED IN .\Out_File\icm20602.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\CODE\icm20602.c LARGE OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(..\..\Libr
                    -aries\libraries;..\..\Libraries\seekfree_libraries;..\..\Libraries\seekfree_peripheral;..\USER\inc;..\USER\src;..\CODE) 
                    -DEBUG PRINT(.\Out_File\icm20602.lst) TABS(2) OBJECT(.\Out_File\icm20602.obj)

line level    source

   1          /*******************************************
   2           * @file            icm20602
   3           * @note            基于逐飞ICM20602的进一步封装
   4           * @author          psq
   5           * @software        MDK
   6           * @target core     STC8H8K64S4
   7           *******************************************/
   8          
   9          #include"icm20602.h"
  10          
  11          // TODO: 陀螺仪零漂，先暂定为0，后续加入自动测定
  12          GyroBias gyro_bais = {0, 0, 0};
  13          
  14          /***************************
  15           * @breif   从icm读取角度值
  16           * @param   void
  17           * @return  车子的倾角
  18           * @note    
  19           ***************************/
  20          float get_angle_from_icm()
  21          {
  22   1          static float degree = 0;
  23   1          float grav_x, grav_z;
  24   1          get_icm20602_accdata_simspi();  // 得到加速度计数据16位，如icm_acc_x
  25   1          grav_x = (icm_acc_x - ACC_X_BIAS) * 1.0 / ACC_X_FACTOR;  // 根据读到的值计算加速度大小
  26   1          grav_z = (icm_acc_z - ACC_Z_BIAS) * 1.0 / ACC_Z_FACTOR;
  27   1          degree = atan2(grav_x, grav_z) * 57.3;  // 实时更新角度
  28   1          // TODO: wwt是像下面这样逐步更新的，赋予了新读到的值比较小的权重
  29   1          // TODO: 不太懂这样做目的是什么，后期看看要不要加上
  30   1          // degree = (39 * degree + atan2(icm_acc_x, icm_acc_z) * 57.3) / 40;
  31   1          return degree;
  32   1      }
  33          
  34          /***************************
  35           * @breif   从icm读取角速度值
  36           * @param   void
  37           * @return  车子的角速度
  38           * @note    
  39           ***************************/
  40          Omega get_omega_from_icm()
  41          {
  42   1          static Omega omega = {0, 0};
  43   1          get_icm20602_gyro_simspi();  // 得到陀螺仪数据16位，如icm_gyro_x
  44   1          omega.y = (float)(-(icm_gyro_y - gyro_bais.y) / GYRO_Y_FACTOR);
  45   1          omega.z = (float)(-(icm_gyro_z - gyro_bais.z) / GYRO_Z_FACTOR);
  46   1          return omega;
  47   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    280    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     24       8
C51 COMPILER V9.60.0.0   ICM20602                                                          06/19/2020 21:33:20 PAGE 2   

   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
